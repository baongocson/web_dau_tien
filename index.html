<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√∫c M·ª´ng 20/10</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        /* --- CSS cho Video Background --- */
        #bg-video {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100; 
            transform: translateX(-50%) translateY(-50%);
            object-fit: cover; 
            filter: brightness(0.65); 
        }
        /* ---------------------------------- */

        body{
            min-height:100vh;
            /* ƒê√£ x√≥a background-image */
            font-family: "Arial Black", Arial, sans-serif; 
            color: #FFFFFF; /* M√†u ch·ªØ tr·∫Øng ƒë·ªÉ d·ªÖ ƒë·ªçc tr√™n n·ªÅn video */
            display:flex;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            text-align:center;
            overflow:hidden;
            padding:1rem;
            position:relative;
            font-size: 1.1rem; 
        }

        h1{
           font-size: 2.6rem; 
           margin-bottom:0.6rem;
           z-index:2;
           font-weight: bold;
        }

        #message{
           font-size: 1.4rem; 
           max-width:600px;
           opacity:0;
           transition:opacity .9s;
           z-index:2;
        }

        /* --- CSS cho ·∫£nh r∆°i --- */
        .falling-img{
            position:absolute;
            top:-120px;
            animation: fall linear forwards;
            transition: transform .3s, filter .3s;
            z-index:1;
            cursor:pointer;
            user-select:none;
        }
        .falling-img:hover{
            transform: scale(1.4) rotate(15deg);
            filter: brightness(1.15);
            animation-play-state: paused;
            z-index:3;
        }
        @keyframes fall{
            0%{ transform: translateY(0) rotate(0deg); opacity:1; }
            100%{ transform: translateY(150vh) rotate(360deg); opacity:.75; }
        }
        
        #soundToggle {
            position: fixed;
            bottom: 15px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 30;
            padding: 8px 12px;
            transition: transform .3s, background .3s;
            user-select: none;
            color: #FFFFFF;
        }
        #soundToggle:hover {
            transform: scale(1.1);
        }

        /* C·∫¨P NH·∫¨T MEDIA QUERY CHO K√çCH TH∆Ø·ªöC CH·ªÆ L·ªöN H∆†N */
        @media (max-width:480px){
            h1{
                font-size: 1.4rem; 
            }
            #message{
                font-size: 1.1rem; 
            }

            #soundToggle {
                font-size: 1.5rem;
                padding: 6px 10px;
                bottom: 10px;
                right: 12px;
            }
        }
    </style>
</head>
<body>
    <video autoplay muted loop id="bg-video">
        <source src="img/videoBackground1.mp4" type="video/mp4">
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video HTML5.
    </video>

    <h1>Qu√† 20/10 cho PChi :3</h1>
    <p id="message"></p>

    <audio id="bgm" src="img/henmotmai.mp3" loop preload="auto"></audio>

    <div id="soundToggle">üîá</div>
    
    <script>
        window.addEventListener('load', () => {
            const messages = [
                "V∆∞·ªùn anh tr·ªìng ch·ªß y·∫øu l√† hoa Nh√¨n em c∆∞·ªùi th·∫ø h√≥a l√† y√™u",
                "Chuy·ªán c·ªï t√≠ch c·ªßa anh l√† cu·ªôc s·ªëng c√≥ em",
                "H·∫°nh ph√∫c c√≥ r·∫•t nhi·ªÅu d·∫°ng v√† em l√† d·∫°ng ƒë·∫ßu ti√™n",
                "Ng∆∞·ªùi ta d√πng t·ª´ d·ªãu d√†ng ƒë·ªÉ mi√™u t·∫£ em, anh d√πng em ƒë·ªÉ mi√™u t·∫£ s·ª± d·ªãu d√†ng",
                "Anh ph·∫£i l√≤ng em m·∫•t r·ªìi"
            ];

            const msgEl = document.getElementById('message');
            let i = 0;
            msgEl.style.opacity = 1;
            setInterval(() => {
                msgEl.style.opacity = 0;
                setTimeout(() => {
                    i = (i + 1) % messages.length;
                    msgEl.textContent = messages[i];
                    msgEl.style.opacity = 1;
                }, 800);
            }, 4800);
            
            // C·∫≠p nh·∫≠t ƒë∆∞·ªùng d·∫´n ·∫£nh r∆°i
            const falling = [];
            for (let k = 1; k <= 12; k++) falling.push(`img/Anh (${k}).png`);
            
            // M·∫£ng ch·ª©a ƒë∆∞·ªùng d·∫´n file √¢m thanh t∆∞∆°ng ·ª©ng
            const voices = [
                "img/AudioTextToSpeech (1).mp3", 
                "img/AudioTextToSpeech (2).mp3", 
                "img/AudioTextToSpeech (3).mp3", 
                "img/AudioTextToSpeech (4).mp3", 
                "img/AudioTextToSpeech (5).mp3", 
                "img/AudioTextToSpeech (6).mp3", 
                "img/AudioTextToSpeech (7).mp3", 
                "img/AudioTextToSpeech (8).mp3", 
                "img/AudioTextToSpeech (9).mp3", 
                "img/AudioTextToSpeech (10).mp3", 
                "img/AudioTextToSpeech (11).mp3", 
                "img/AudioTextToSpeech (12).mp3"
            ];
            
            const activePositions = [];
            function createFallingImage() {
                let left;
                const safe = 8;
                const minDistance = 10;
                let tries = 0;
                do {
                    left = safe + Math.random() * (100 - 2 * safe);
                    tries++;
                } while (activePositions.some(x => Math.abs(x - left) < minDistance) && tries < 20);

                const randomIndex = Math.floor(Math.random() * falling.length);
                
                const el = document.createElement('img');
                el.className = 'falling-img';
                el.src = falling[randomIndex];
                el.style.left = left + 'vw';
                
                // G·∫Øn ƒë∆∞·ªùng d·∫´n file √¢m thanh v√†o thu·ªôc t√≠nh data-voice-src
                el.setAttribute('data-voice-src', voices[randomIndex]); 

                // THAY ƒê·ªîI: TƒÉng k√≠ch th∆∞·ªõc ·∫£nh r∆°i
                let min = 95, max = 145; // TƒÉng t·ª´ 80-120 l√™n 95-145 (kho·∫£ng 20%)
                if (window.innerWidth <= 480) { min = 50; max = 85; } // TƒÉng t·ª´ 40-70 l√™n 50-85
                else if (window.innerWidth <= 768) { min = 75; max = 110; } // TƒÉng t·ª´ 60-90 l√™n 75-110
                
                el.style.width = (min + Math.random() * (max - min)) + 'px';
                el.style.animationDuration = (8 + Math.random() * 4) + 's';
                el.style.transform = `rotate(${Math.random() * 360}deg)`;

                
                // X·ª≠ l√Ω s·ª± ki·ªán nh·∫•n (click) ƒë·ªÉ ph√°t √¢m thanh
                el.addEventListener('click', function() {
                    const src = this.getAttribute('data-voice-src');
                    
                    // T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng Audio m·ªõi
                    const audio = new Audio(src);
                    
                    // Ph√°t √¢m thanh
                    audio.play().catch(e => console.error("L·ªói ph√°t √¢m thanh:", e));
                    
                    // X√≥a ƒë·ªëi t∆∞·ª£ng Audio sau khi ph√°t xong (t√πy ch·ªçn)
                    audio.onended = () => {
                        audio.remove();
                    };
                });

                document.body.appendChild(el);
                activePositions.push(left);

                setTimeout(() => {
                    el.remove();
                    const idx = activePositions.indexOf(left);
                    if (idx !== -1) activePositions.splice(idx, 1);
                }, 14000);
            }

            setInterval(createFallingImage, 1100);

            const bgm = document.getElementById('bgm');
            const toggle = document.getElementById('soundToggle');
            let playing = false;

            toggle.addEventListener('click', async () => {
                try {
                    if (!playing) {
                        bgm.currentTime = 68;
                        await bgm.play();
                        toggle.textContent = "üîà";
                        playing = true;
                    } else {
                        bgm.pause();
                        toggle.textContent = "üîá";
                        playing = false;
                    }
                } catch (err) {
                    console.log("Kh√¥ng th·ªÉ ph√°t", err);
                }
            });
        });
    </script>
</body>
</html>